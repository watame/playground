# セマフォでの並列
並列処理の問題
- 並列タスクの同時実行数を制御したい場合がある
  - スクレイピング
  - レート制限がかかっているAPI
  - CPU/メモリーの負荷を抑えたい
- Pythonでは以下の2つがよく使われる
  - ThreadPoolExecutor / ProcessPoolExecutor
    - 同時実行数を制御するオプションがない
      - 最大Nタスクまで実行する時にどうするか

# 工夫の仕方
- tume.sleep
  - 待機する
- グローバルなカウンター変数
  - Job数を常に監視しながら動作させる
- ロックオブジェクト
  - redis, 空ファイルのデータ存在チェック

# Semaphore（セマフォ）を知ってほしい
限られた容量のリソースへのアクセスを制御するために利用する
- リソースは「獲得」した後に「解放」しないといけないもの
- セマフォは「獲得/解放の回数」を監視する

# SemaphoreとBoundedSemaphore
- semaphore
  - `threading.Semaphore(1)`の様に設定できる
- bounded semaphore
  - 解放し過ぎたくない場合に利用すると便利
  - `release()`関数で解放しすぎると例外が発生する

# 終わりに
並列プログラミングで「同時にN個まで」と制限する必要があった場合はエレガントに解決できるかも！

スクレイピングやっている人は全員役立つと思う。
-> リクエストの同時実行数を制御できるから良いかと思う。

https://qiita.com/hankehly/items/b4e8ea1df70a6b638480
