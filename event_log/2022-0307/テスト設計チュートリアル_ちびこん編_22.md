# テスト設計チュートリアル ちびこん編'22
* 講師：蛭田

# 資料
* http://aster.or.jp/testcontest/tutorial.html#chibicon3

# 講義
* 2022_chibicon_V1.0.0.pdfを基に発表

## ゴール
テストを**開発する**プロセスをイメージできるようになる
-> 流れを少しでもイメージできるようになってればOK

テストを作るのではなく、テストを開発する。
-> どうなっているのかわからない状態の中で、どのようにアプローチすればテストをできるかを考えながら、テストケースを作り出す。

## 前提
* テスト値
  * 「3」のような具体的なもの
* テストパラメータ
  * 「辺の長さ」のようにテスト観点の最も具体的なもの
    * テストパラメータの特定の要素がテスト値となる
  * (3,3,3)を入力すると正三角形と表示される」のようにテスト値の集まり
  * 「有効な正三角形」から「ドメイン知識」までテストパラメータや、テストパラメータを抽象化したものをテスト観点と呼ぶ

## 1.テスト観点の整理
まずは演習
以下のプログラムをテストするのに十分と思われるテストケースを網羅する
* 入力ダイアログから3つの整数を読む
* 3つの値は、それぞれ三角形の三辺の長さを表すものとする
* 三角形が不当辺三角形、二等辺三角形、正三角形の内どれであるかを示すメッセージを表示する

自身の回答(3分)
* 入力ダイアログから3つの整数を読む
  * 数値以外の文字列を入力
  * 空白を入力
  * マイナスを入力
  * 少数を入力
  * UnsignedIntの範囲を大幅に超えた値を入力
  * 文字コードを入力
* 3つの値は、それぞれ三角形の三辺の長さを表すものとする
* 三角形が不当辺三角形、二等辺三角形、正三角形の内どれであるかを示すメッセージを表示する
  * 値が3つ等しい場合、正三角形と表示
  * 値が2つ等しい場合、二等辺三角形と表示
  * 値が等しくない場合、不当辺三角形と表示

-> テスト洗い出しの過程の中で、各開発者が考えていることがわかる

どの範囲でテストを見るのかは人それぞれとなる。
* 入力範囲
* システム全体
* 時間
* ユーザー属性

仮に簡単な仕様であってもテストケースを網羅することは難しい
また、人によってテストケースの表現（具体的な値、期待結果）が異なる
-> そもそもテストケースがどれだけ網羅されているのか、自分でも把握できない。

テストケースを列挙するのではなく、構造化することが大事
-> RSpecの構造化も同じ！

テストすべきこと = テスト観点
-> 思いついたことをテストケースとするのではなく、テスト観点を整理して網羅していくとテストケースが充実する

テスト観点を**抽象化**すると見通しが良くなる。
以下ぐらい抽象的で良い。
* 三角形の形
* 辺の組み合わせ
* 操作性
* セキュリティ

### テスト観点の整理方法
ボトムアップとトップダウンが存在するが、実際はトップダウンとボトムアップを循環させながらテスト観点を網羅していく。

マインドマップ・モデリングツールを利用すると良い。

#### ボトムアップ
具体的に与えられる値から観点を整理していく。
例：値(1,2,3) -> 不当辺三角形

#### トップダウン
最も抽象的な観点から整理
例：三角形 -> 成立する

### 基本的なテストの方針
網羅もピンポイントも両方とも必要。

#### 網羅
隅から隅までテストする。
* 漏れなくテストを行う
* 動作実績を積み上げて品質を保証する「保証型」のテスト

漏れなく考えることを誘導するために、フレームワークを利用するのが良い。
-> どういった視点で整理できるのかを把握したうえでフレームワークを利用する

* フレームワーク
  * ラルフチャート
    * Input, Outputに注目
  * Tiramis
    * 基本構造構成要素
      * テスト対象を網羅化したフレームワーク
      * 人も含まれる
  * 論理的機能構造
    * 機能面にかなり寄ったTiramis

多面的に様々なことを考えつくす。
-> 仕様書の文・単語を移してもテスト観点は網羅出来ない
    仕様書は通常不完全で、致命的なバグは仕様書には存在しない
-> 特定の側面だけでなく多面的に上げる必要がある
    入力に関するテスト観点だけを挙げたり、品質特性だけをテスト観点として採用すると、漏れが発生する
-> テスト観点を上げるだけでバグが見つかることもある
    開発者が考慮していなかったテスト観点

そもそも全数テストは不可能で、テストは条件次第なので、テストがいちい的に収束することはない
-> 整理したものを利害関係者と合意を取ることが重要

#### ピンポイント
* バグが起きそうなところを狙ってテストをする
* 少ない手間でたくさん危険なバグを検出する「検出型」のテスト

以下の観点で整理（HAZOPのためのガイドワードを利用するのがベター）
* 起きてほしくないこと
* バグ
* 後工程でバグを引き起こしそうな罠や弱点

### テスト観点を上げるときの注意点
色んな側面でテスト観点を出そう。
* 網羅、ピンポイントの両方の観点でテスト観点を作成する

## 2.テストフレームを考えよう
人によって簡単なテストケースもあれば複雑なものもある
-> テストケースにはテスト観点が含まれている

狙いたい側面、狙いたい意図があってテストフレームが作成される。
-> 言いたいことを明確にする必要がある

同じ機能をテストする場合でも、テストの感心事はテストフレームによって異なる
-> 要素が少ないものもあれば、多いものもある
-> 要素が多すぎるとテスト詳細設計をする際にテスト値が一意にならなくて辛い）

どういった意図があるのかはテストコンテナで言及。

テストフレームに沿ったテストケースの構造を作成する。
-> テストフレームの各要素がテストケースを作成する際のヘッダの役割を果たす

## 3.テストコンテナとその間の関係性を考えよう
テストコンテナ = テスト観点やテストフレームをまとめたもの

どうやってまとめるか？
* テストレベル
  * コンポーネントテスト
  * システムテスト
* テストタイプ
  * 負荷テスト
  * 構成テスト
* テストサイクル
  * 1回目のテスト
  * 2回目のテスト
* その他
  * 扱いやすい形でコンテナを作ることもある

テストコンテナは各組織で定められたものをそのまま使うことが多いので、自分たちでは設計することは少ない
-> その後のテストをやりやすくするためにテストコンテナがあるので、作り直す方が良いこともある

自分たちがどういうテストコンテナを作るのが都合が良いのかを定義するのが良い。
-> その後の会話の「主語」になるものなので、単位も含めて検討しよう

一般に紹介されているテストコンテナを参考にして、なぜそのようにまとめたか、リバースエンジニアリングしてみるのが良い
-> 何の利点があるのかもわからずに利用するのはもったいない

良いテストコンテナ
* 結合度が低い
  * 別のテストコンテナの影響を受けにくい
  * 例：機能性テストコンテナ、使用性テストコンテナを分けているのに仕様変更で2つのコンテナを変えなきゃならないならば、結合度が低い
* 凝集度が高い
  * テストコンテナの意図が明確でわかりやすい
  * 例：1つのテストコンテナの結果としていい結果と悪い結果が両方出てくる（どっちが正しいかわからない）

テストコンテナの関連性をモデリングする
-> テストコンテナ同士の順序、関係性を示そう
    テストコンテナという大きな関係をまとめることで、大きな連携箇所に気付くことが出来る

テストアーキテクチャ
* テストコンテナ間の関係性を決めたもの

テストアーキテクチャを考える意味
* 全体像の俯瞰が可能になる
  * 後工程や次プロジェクトでテストしやすいようにテストコンテナをまとめて、前後関係や並列関係を考える
* まずは最初の一歩として**順序性**を考えよう

テストコンテナでテストが扱いやすくなる！
-> 関係性を組み合わせてテストアーキテクチャを作成し、どうやってテストすれば良いのかを考えよう。

## 4.テスト観点からテスト値を網羅しよう
### 1.テスト観点がどのタイプのテストモデルなのかを見極める
テストモデルは4つある
* 範囲
  * ある連続した範囲を意味するテスト観点を網羅するときに用いる
  * 網羅基準例
    * 代表値網羅
      * テスト値は少数に収まるが漏れが発生することも
    * 境界値網羅
      * 上限下限を意識してテスト値を決める
    * 全網羅
      * 漏れはないがテスト値が暴対になるため、現実的ではない
  * 同値分割法・境界値分析がよく使われる
    * 分析例
        * テストパラメータ：パスワードの文字列長
        * テストモデル：範囲タイプ
        * カバレッジ基準：境界値網羅
* 一覧表
  * 複数の要素からなる集合を意味するテスト観点を網羅するときに用いる
    * 代表値網羅
    * 境界値網羅
    * 全網羅
  * 指標例（ブラウザ）
    * テストパラメータ：ブラウザの種類
    * テストモデル：一覧表タイプ
    * カバレッジ基準：代表値網羅（シェア80%以上）
      * テストモデルを利用することでカバレッジの基準の見直し等も行える
* マトリクス
  * 2つ以上のテスト観点の**組合せ**を網羅するときに用いる
    * 代表値網羅
    * Ｎ-Wise網羅
        * どう組み合わせるかを判断する
        * ペアワイズテストなど
    * 全網羅
  * ペアワイズテスト
    * テストパラメータ：OS、アーキテクチャブラウザ
    * テストモデル：マトリクスタイプ
    * カバレッジ基準：2-Wise網羅
      * 2因子網羅100%の場合、以下の組合せが全てが少なくとも1回以上出現している
        * OS, アーキテクチャ
        * OS, ブラウザ
        * ブラウザ, アーキテクチャ
* グラフ
  * 丸と線で図を書けるようなテスト観点を網羅するときに用いる
    * 代表パス網羅
      * ハッピーパス網羅
    * ノード網羅
      * 状態が網羅できるようにする
    * リンク網羅
      * ルートを全て網羅する
    * Nスイッチ網羅
      * 遷移の仕方、フローも考慮して網羅する
    * 全パス網羅
  * 状態遷移テスト
    * テストパラメータ：ログインステータスの遷移
    * テストモデル：グラフタイプ
    * カバレッジ基準：1スイッチカバレッジ

テストモデルから導くテスト値は2種類ある
* テスト値が直接テスト手順の一部として実施できるもの
  * テスト値がそのままテスト実行に使える
* テスト値からさらにテストデータを導く必要があるもの
  * 特定の値を入れている場合は、特定のパスを通るなど、テスト値がそのままテスト実行に使えない

いきなりテストケースを導くのは良くない
-> テストフレームに関連するテスト値を網羅基準を持って導くのが良い

テスト設計技法を用いながら、テスト値を考えるのも良いです。

## 5.テスト開発を意識して進めてみよう
テストを開発するには段階的なプロセスが必要。
-> テストアーキテクチャを考えよう

ソフトウェア開発プロセスと、テスト開発プロセスを対応させてとらえてやると良い
-> 抽象と具体を対応させる
-> 何をテストするか、どうテストするかを考える

テスト開発プロセスを日々の仕事の中でも考えて過ごそう。

# QA
* テスト開発の流れでは、テストフレームを作った後にテストコンテナに入れていくということでしたが、テストコンテナを先に作ってテスト観点を入れて、テストコンテナの中のテスト観点を使ってテストフレームを作成するという方法でも問題ないでしょうか？
  * 漏れなく出せるのであれば良いが、コンテナを作るタイミングで考慮が漏れることが起きやすいので、テスト観点が多面的に出せているかを気を付けよう
* アジャイル開発におけるテスト設計で気を付ける観点
  * テストコンテナを考え、自動で行うテスト、手動で行うテストはぶれないように。テスト観点とテスト値を意識する + スピード感を持ちながら対応する必要がある